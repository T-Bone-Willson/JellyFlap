<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">

	<title>FlappyJS</title>

	<script src="sprite.js"></script>

	<style>
	canvas {
		display: block;
		position: absolute;
		margin: auto;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
	}
	</style>
</head>
<body>
<script>

var

canvas,
ctx,
width,
height,
fgpos = 0, // This variable dictated the position of the foreground sprite
frames = 0,
score = 0,
best = 0,
// ^^ These are all variables

currentstate, //Creates the differnt states for the game
states = {
	Splash: 0, Game: 1, Score : 2
},

bird = {
	// position of Jelly Fish
	x: 60,
	y: 0,
	frame: 0,
	velocity: 0,
	// Frame animation sequence. Tells the code which sprite to draw/animate first, second and then last
	animation: [0, 1, 2, 1],
	rotation: 0,
	// Set gravity for the bird to fall.
	gravity: 0.25,
	// sets how high the jelly fish jumps
	jumpHeight: 4.6,

	jump: function(){
		this.velocity = -this.jumpHeight
	},

	update: function(){
		// This checks the states of the animation frames... I believe.
		var nFrame = currentstate === states.Splash ? 10 : 5;
		this.frame += frames % nFrame === 0? 1 : 0;
		this.frame %= this.animation.length;
		// Either way, it works!

		if (currentstate === states.Splash){
			this.y = height - 280 + 5*Math.cos(frames/10); //makes the bird go 5 px and down 5px in a constant 10 frame sper second.
			this.rotation = 0;
		}
	},
	draw: function(ctx){

		ctx.save();
		ctx.translate(this.x, this.y);
		ctx.rotate(this.rotation);

		var nFrame = this.animation[this.frame];
		s_bird[nFrame].draw(ctx, - s_bird[nFrame].width/2, - s_bird[nFrame].height/2);

		ctx.restore();
	},
},

pipes = {

	update: function(){

	},
	draw: function(ctx){

	},
}; // ';' closes off the variables above ^^

// Boilerplater Game loop
function main(){
	canvas = document.createElement("canvas");
	width = window.innerWidth;
	height =window.innerHeight;

	if(width >= 500){ // checks screen width to see if it's a mobile
		width = 320; // reset width to this
		height = 480; // reset height to this
		canvas.style.border = "1px solid #000"; // creates border
	}

	canvas.width = width;
	canvas.height = height;
	ctx = canvas.getContext("2d");

	// State of the game 
	currentstate = states.Splash;

	document.body.appendChild(canvas);
	// Load sprit sheet
	var img = new Image();
	img.onload = function(){
		initSprites(this); // 'this' is pointing to the object "initsprites"
		ctx.fillStyle = s_bg.color; // 'color' is "#70C5CF" on sprite sheet
		run();
	}
	img.src = "res/sheet.png";
}

function run(){
	var loop = function(){
		update();
		render();
		window.requestAnimationFrame(loop, canvas);
	}
	window.requestAnimationFrame(loop, canvas);
}

function update(){
	frames++
	// Makes forground position constantly move to the left
	fgpos = (fgpos -2) % 14;

	bird.update();
	pipes.update();
}

function render(){
	ctx.fillRect(0, 0, width, height);
	// 's_bg' is background sprite
	// sets background sprite in correct position and size
	s_bg.draw(ctx, 0, height - s_bg.height);
	s_bg.draw(ctx, s_bg.width, height - s_bg.height); 

	// Renders animation frames for bird
	bird.draw(ctx);
	pipes.draw(ctx);

	//sets forground sprite in correction position and size
	s_fg.draw(ctx, fgpos, height - s_fg.height);
	s_fg.draw(ctx, fgpos + s_fg.width, height - s_fg.height);
}

main();

</script>
</body>
</html>